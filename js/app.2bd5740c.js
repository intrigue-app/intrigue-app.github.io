(function(){"use strict";var e={1251:function(e,t,s){var n=s(9242),o=s(3396);function r(e,t,s,n,r,i){const d=(0,o.up)("Canvas"),a=(0,o.up)("Menu");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(d),(0,o.Wm)(a)],64)}var i=s(4892),d=s.n(i),a=s(7139);function c(e,t,s,r,i,d){const c=(0,o.up)("Node"),u=(0,o.up)("Cursor");return(0,o.wg)(),(0,o.iD)("div",{class:"canvas",style:(0,a.j5)(d.styles),onClick:t[1]||(t[1]=e=>i.selection=[]),onDblclick:t[2]||(t[2]=(...e)=>d.newNode&&d.newNode(...e))},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.store.nodes,(e=>((0,o.wg)(),(0,o.j4)(c,{key:e.id,ref_for:!0,ref:e.id,node:e,onMousedown:t=>d.selectNode(e),onClick:t[0]||(t[0]=(0,n.iM)((()=>{}),["stop"])),onDrag:d.onNodeDrag,onDragEnd:d.onNodeDragEnd},null,8,["node","onMousedown","onDrag","onDragEnd"])))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.document.users,(e=>((0,o.wg)(),(0,o.j4)(u,{key:e.id,id:e.id,name:e.name,x:e.cursorX,y:e.cursorY},null,8,["id","name","x","y"])))),128))],36)}var u=s(2482),l=s(691),h=s(6866),p=s(4870),m=s(1346),f=s(5697),v=s(3089),g=s(9432);class y{constructor(){(0,u.Z)(this,"emitter",void 0),this.emitter=(0,g.i)()}on(e,t){return this.emitter.on(e,t)}emit(e,t){this.emitter.emit(e,t)}}(0,m.QB)(h);class b extends y{constructor(e){super(),(0,u.Z)(this,"id",void 0),(0,u.Z)(this,"userId",void 0),(0,u.Z)(this,"users",void 0),(0,u.Z)(this,"localUser",void 0),(0,u.Z)(this,"store",void 0),(0,u.Z)(this,"syncProvider",void 0),(0,u.Z)(this,"saveProvider",void 0),this.users=(0,p.qj)({});const t=new URLSearchParams(window.location.search).get("id");this.id=t||(0,l.x0)(),this.store=(0,m.wI)(e);const s=(0,m.mL)(this.store);this.syncProvider=new f.x$(this.id,s),this.saveProvider=new v.H7(this.id,s),this.syncProvider.awareness.on("change",this.__handleChanges.bind(this)),this.userId=(0,l.x0)(),this.syncProvider.awareness.setLocalStateField("id",this.userId),this.store.metadata.id=this.id,this.store.metadata.name="Untitled",this.localUser=(0,p.qj)(this.users[this.userId]),console.warn=()=>{}}updateAwareness(e,t){this.syncProvider.awareness.setLocalStateField(e,t)}__handleChanges(){const e=this.syncProvider.awareness.getStates().values(),t=new Set,s=new Set(Object.keys(this.users));for(const n of e){t.add(n.id),s.delete(n.id),this.users[n.id]||(this.users[n.id]={});for(const[e,t]of Object.entries(n))this.users[n.id][e]=t}for(const n of s)delete this.users[n]}}class w extends b{constructor(e){super(e),(0,u.Z)(this,"inverses",void 0),(0,u.Z)(this,"undoStack",void 0),(0,u.Z)(this,"redoStack",void 0),this.inverses={},this.undoStack=[],this.redoStack=[]}registerInverses(e,t){this.inverses[e]=t,this.inverses[t]=e}commit(e,t){let s;const n=this[e].bind(this);void 0!==n?(s=n(t),s&&(this.undoStack.push({action:e,inverseParams:s}),this.redoStack=[])):console.error(`There is no method called ${e}() on this object:`,this)}popStackItem(e,t){if(e.length<=0)return;const s=e.pop();if(!s)return;const n=this.inverses[s.action];if(!n)return void console.error(`There is no registered inverse for ${s.action}().`);let o;const r=this[n].bind(this);void 0!==r?(o=r(s.inverseParams),t.push({action:n,inverseParams:o})):console.error(`There is no method called ${n}() on this object:`,this)}undo(){this.popStackItem(this.undoStack,this.redoStack)}redo(){this.popStackItem(this.redoStack,this.undoStack)}}function k(e,t,s){const n=t.split("."),o=n.length-1;for(let i=0;i<o;++i){const t=n[i];e=e[t]??(e[t]={})}const r=n[o];return void 0!==s&&(e[r]=s),e[r]}class x{}(0,u.Z)(x,"Note","note"),(0,u.Z)(x,"Reference","reference"),(0,u.Z)(x,"Area","area");class N extends w{constructor(){super({metadata:{},nodes:{},links:{},fragment:"xml"}),this.registerInverses("createNode","deleteNode"),this.registerInverses("createNodes","deleteNodes"),this.registerInverses("updateNode","updateNode"),this.registerInverses("snapNode","unsnapNode"),this.registerInverses("createLink","removeLink")}createNode(e){const t=e.id?e.id:(0,l.x0)(),s={id:t,type:e.type,content:e.content,links:[],parent:null,children:[],x:e.x?e.x:0,y:e.y?e.y:0};if(e.links)for(const n of e.links)this.createLink(n);if(e.children)for(const n of e.children)this.snapNode(n);return this.store.nodes[t]=s,t}createNodes(e){const t=[],s=[],n=[];for(const o of e){if(o.links){for(const e of o.links)s.push(e);delete o.links}if(o.children){for(const e of o.children)n.push(e);delete o.children}const e=this.createNode(o);t.push(e)}for(const o of s)this.createLink(o);for(const o of n)this.snapNode(o);return t}deleteNode(e){const t={...this.store.nodes[e]},s=[],n=[];for(const o of t.links)s.push(this.removeLink(o));for(const o of t.children)n.push(this.unsnapNode({source:t.id,target:o}));return t.links=s,t.children=n,delete this.store.nodes[e],t}deleteNodes(e){const t=[];for(const s of e){const e=this.deleteNode(s);t.push(e)}return t}updateNode(e){const t=this.store.nodes[e.id],s={id:e.id};if(e.by){s.by={};for(const[n,o]of Object.entries(e.by)){const e=k(t,n);"number"===typeof e?(k(t,n,e+o),s.by[n]=-e):console.error("Only number properties can be updated by a number!")}}if(e.set){s.set={};for(const[n,o]of Object.entries(e.set)){const e=k(t,n);k(t,n,o),s.set[n]=e}}return s}updateNodes(e){const t={id:[...e.id]};if(e.by){t.by={};for(const[s,n]of Object.entries(e.by))t.by[s]=-n;for(const t of e.id)this.updateNode({id:t,by:e.by})}return e.set&&console.error("Cannot set multiple values. Currently only updating multiple nodes by value is supported."),t}snapNode(e){const t={};if(!e.source||!e.target)return!1;const s=this.store.nodes[e.source],n=this.store.nodes[e.target];return(s.type===x.Area||0===s.children.length)&&(s.children.push(e.target),s.children.filter(((e,t)=>s.children.indexOf(e)===t)),n.parent=s.id,t.source=e.source,t.target=e.target),!!t.source&&t}unsnapNode(e){const t={};if(!e.source||!e.target)return!1;const s=this.store.nodes[e.source],n=this.store.nodes[e.target],o=s.children.indexOf(e.target);return o>-1&&(s.children.splice(o,1),n.parent=null,t.source=e.source,t.target=e.target),!!t.source&&t}createLink(e){const t=this.store.nodes[e.source],s=this.store.nodes[e.target],n=e.id?e.id:(0,l.x0)(),o={id:n,source:e.source,target:e.target};return this.store.links[n]=o,t.links.push(n),t.links.filter(((e,s)=>t.links.indexOf(e)===s)),s.links.push(n),s.links.filter(((e,t)=>s.links.indexOf(e)===t)),n}removeLink(e){const t={...this.store.links[e]},s=this.store.nodes[t.source],n=this.store.nodes[t.target];return s.links.splice(s.links.indexOf(e),1),n.links.splice(n.links.indexOf(e),1),delete this.store.links[e],t}}const I=new N;function S(e,t,s,n,r,i){return(0,o.wg)(),(0,o.iD)("div",{class:(0,a.C_)(["node noselect",i.classes]),ref:"node",style:(0,a.j5)(i.styles)},(0,a.zw)(s.node.content),7)}var $=s(3099),O={name:"IntrigueNode",props:{node:Object},data(){return{document:I,gesto:null,x:this.node.x,y:this.node.y}},mounted(){this.selection=this.document.users[this.document.userId].selection,this.getso=new $.Z(this.$refs.node,{container:window,pinchOutside:!0}).on("drag",(e=>{this.$emit("drag",e)})).on("dragEnd",(e=>{this.$emit("drag-end",e)}))},computed:{classes(){return{selected:this.selectedByCurrentUser,"remote-selected":this.selectedByRemoteUsers}},styles(){return{"--bg-color":"rgb(250, 248, 229)","--border-color":"rgb(233, 183, 109)",transform:`translate(${this.x}px, ${this.y}px)`}},selectedByCurrentUser(){return this.document.localUser.selection.includes(this.node.id)},selectedByRemoteUsers(){for(let[e,t]of Object.entries(this.document.users))if(e!==this.document.userId&&t.selection.includes(this.node.id))return!0;return!1}},watch:{"node.x":function(){this.x=this.node.x},"node.y":function(){this.y=this.node.y}}},_=s(89);const j=(0,_.Z)(O,[["render",S]]);var T=j;const Z=e=>((0,o.dD)("data-v-d0bb4c60"),e=e(),(0,o.Cn)(),e),C=Z((()=>(0,o._)("div",{class:"arrow"},null,-1)));function A(e,t,s,n,r,i){const d=(0,o.up)("Avatar");return r.document.localUser.id!==s.id?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"cursor",style:(0,a.j5)({transform:`translate(${s.x}px, ${s.y}px)`})},[C,(0,o.Wm)(d,{class:"avatar",variant:"beam",name:s.name,size:20},null,8,["name"])],4)):(0,o.kq)("",!0)}var L=s(8729),D={name:"IntrigueCursor",components:{Avatar:L.Z},props:{id:String,name:String,x:Number,y:Number},data(){return{document:I}}};const P=(0,_.Z)(D,[["render",A],["__scopeId","data-v-d0bb4c60"]]);var U=P,E={name:"IntrigueCanvas",components:{Node:T,Cursor:U},props:{},data(){return{document:I,store:I.store,x:0,y:0,selection:[]}},methods:{newNode(e){this.document.commit("createNode",{type:x.Note,content:"<p></p>",x:e.clientX+this.x-14,y:e.clientY+this.y-14})},selectNode(e){this.selection=[e.id]},onNodeDrag(e){for(let t of this.selection){const s=this.$refs[t][0];s.x+=e.deltaX,s.y+=e.deltaY}},onNodeDragEnd(e){this.document.commit("updateNodes",{id:[...this.selection],by:{x:e.distX,y:e.distY}})}},mounted(){window.addEventListener("mousemove",(e=>{this.document.updateAwareness("cursorX",e.clientX-this.x),this.document.updateAwareness("cursorY",e.clientY-this.y)})),window.addEventListener("mousewheel",(e=>{console.log(e),this.x-=e.deltaX/2,this.y-=e.deltaY/2,this.document.updateAwareness("x",this.x),this.document.updateAwareness("y",this.y)})),this.document.updateAwareness("selection",[])},computed:{styles(){return{transform:`translate(${this.x}px, ${this.y}px)`}}},watch:{selection(){this.document.updateAwareness("selection",[...this.selection])}}};const M=(0,_.Z)(E,[["render",c],["__scopeId","data-v-fa2674b4"]]);var Y=M;const W={class:"menu"},X={class:"state align-left"},z={class:"sharing align-right"};function B(e,t,s,n,r,i){const d=(0,o.up)("Avatars");return(0,o.wg)(),(0,o.iD)("div",W,[(0,o._)("div",null,[(0,o._)("input",{type:"text",ref:"title",class:"align-left",onMousedown:t[0]||(t[0]=e=>n.send({type:"editing title"})),onBlur:t[1]||(t[1]=e=>n.send({type:"stop editing title"})),onKey:t[2]||(t[2]=(...t)=>e.updateTitleWidth&&e.updateTitleWidth(...t))},null,544),(0,o._)("span",X,(0,a.zw)(n.state.value),1),(0,o._)("span",z,[(0,o.Wm)(d),(0,o._)("button",{onClick:t[3]||(t[3]=(...e)=>i.copyShareLink&&i.copyShareLink(...e))},(0,a.zw)(r.buttonText),1)])])])}var R=s(1552),H=s(7201);const K={initial:"Idle",states:{Idle:{on:{"editing title":"TitleEditing","click on node":"#Intrigue.Arranging"}},TitleEditing:{on:{"stop editing title":"Idle"}}}},q={initial:"Selected",states:{Selected:{on:{"click on empty canvas":"#Intrigue.Viewing","drag node handle":"Resizing"}},Resizing:{on:{"drag end":"Selected"}}}},F=(0,R.C)({id:"Intrigue",initial:"Viewing",states:{Viewing:{...K},Arranging:{...q}}});(0,H.kJ)(F).start();var V=s(354),J=s(982);const Q={class:"avatars"};function G(e,t,s,n,r,i){const d=(0,o.up)("Avatar"),a=(0,o.up)("Popper");return(0,o.wg)(),(0,o.iD)("span",Q,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.document.users,(e=>((0,o.wg)(),(0,o.j4)(a,{class:"popper",key:e.id,content:e.id===r.document.userId?e.name+" (Me)":e.name,hover:!0},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{class:"avatar",variant:"beam",name:e.name,size:25},null,8,["name"])])),_:2},1032,["content"])))),128))])}var ee=s(3758),te={name:"IntrigueAvatars",components:{Avatar:L.Z,Popper:ee.Z},data(){return{store:I.store,document:I,tooltipText:null,tooltipX:0}},methods:{},mounted(){},computed:{},watch:{}};const se=(0,_.Z)(te,[["render",G],["__scopeId","data-v-564022fb"]]);var ne=se,oe={name:"IntrigueMenu",components:{Avatars:ne},data(){return{store:I.store,document:I,buttonText:"Copy Link",buttonTimer:null}},methods:{copyShareLink(){(0,J.J)(this.sharingUrl),this.buttonText="Copied!",this.buttonTimer&&(clearTimeout(this.buttonTimer),this.buttonTimer=null),this.buttonTimer=setTimeout((()=>{this.buttonText="Copy Link",this.buttonTimer=null}),1e3)}},setup(){const{state:e,send:t}=(0,V.e)(F);return{state:e,send:t}},mounted(){this.$refs.title.value=this.store.metadata.name,this.$refs.title.addEventListener("blur",(()=>{this.store.metadata.name=this.$refs.title.value})),this.$refs.title.addEventListener("keydown",(()=>{this.store.metadata.name=this.$refs.title.value,this.$refs.title.style.width=`${this.$refs.title.value.length}ch`})),this.$refs.title.style.width=`${this.$refs.title.value.length}ch`},computed:{sharingUrl(){return`${window.location.origin}/?id=${this.store.metadata.id}`}},watch:{"store.metadata.name":function(){this.$refs.title.value=this.store.metadata.name}}};const re=(0,_.Z)(oe,[["render",B],["__scopeId","data-v-2bbe52b9"]]);var ie=re,de={name:"App",components:{Menu:ie,Canvas:Y},data(){return{store:I.store,document:I}},methods:{broadcastUsername(){const e=d()("en",{maxWords:1});this.document.updateAwareness("name",`Anonymous ${e}`)}},mounted(){this.broadcastUsername()}};const ae=(0,_.Z)(de,[["render",r]]);var ce=ae;(0,n.ri)(ce).mount("#app")}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,s),r.exports}s.m=e,function(){var e=[];s.O=function(t,n,o,r){if(!n){var i=1/0;for(u=0;u<e.length;u++){n=e[u][0],o=e[u][1],r=e[u][2];for(var d=!0,a=0;a<n.length;a++)(!1&r||i>=r)&&Object.keys(s.O).every((function(e){return s.O[e](n[a])}))?n.splice(a--,1):(d=!1,r<i&&(i=r));if(d){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[n,o,r]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,r,i=n[0],d=n[1],a=n[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(o in d)s.o(d,o)&&(s.m[o]=d[o]);if(a)var u=a(s)}for(t&&t(n);c<i.length;c++)r=i[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(u)},n=self["webpackChunkintrigue_web"]=self["webpackChunkintrigue_web"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=s.O(void 0,[998],(function(){return s(1251)}));n=s.O(n)})();
//# sourceMappingURL=app.2bd5740c.js.map